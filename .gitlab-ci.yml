image: node:20.11.1-bullseye-slim
stages:

  - dependencycheck


fs-scanning:
  stage: filesystem-scan
  image:
    name: aquasec/trivy:latest
    entrypoint: [""]
  script:
    - trivy fs .    

include:
  - template: Jobs/Build.gitlab-ci.yml
  - template: Jobs/Container-Scanning.gitlab-ci.yml

container_scanning:
  variables:
    CS_DEFAULT_BRANCH_IMAGE: $CI_REGISTRY_IMAGE/$CI_DEFAULT_BRANCH:$CI_COMMIT_SHA


dependencycheck:
    stage: dependencycheck
    image:
        name: owasp/dependency-check
        entrypoint: [""]
#    before_script:
#        - mkdir data
#        - mkdir dependency-check
    script:
        - /usr/share/dependency-check/bin/dependency-check.sh --project Test --out . --scan . NVD_API_KEY=e043b5d6-0bdc-44f2-b335-2335ade6085a --enableExperimental --failOnCVSS 7